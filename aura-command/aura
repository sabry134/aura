#!/bin/sh

START_TIME_FILE="$HOME/.aura_start_time"  # File to store the start time

error() {
    echo "Error: $1" >&2
    exit 1
}

uptime() {
    if [ ! -f "$START_TIME_FILE" ]; then
        echo "Error: Bot has not started yet."
        exit 1
    fi

    START_TIME=$(cat "$START_TIME_FILE")  # Read the start time from the file
    CURRENT_TIME=$(date +%s)
    DIFF=$((CURRENT_TIME - START_TIME))

    # Convert seconds into days, hours, minutes, and seconds
    DAYS=$((DIFF / 86400))
    HOURS=$(( (DIFF % 86400) / 3600 ))
    MINUTES=$(( (DIFF % 3600) / 60 ))
    SECONDS=$((DIFF % 60))

    # Display uptime in a readable format
    echo "Bot uptime: ${DAYS}d ${HOURS}h ${MINUTES}m ${SECONDS}s"
}

case "$1" in
    help)
        echo "Aura CLI - Help Menu"
        ;;
    run)
        if [ "$#" -lt 2 ]; then
            error "Usage: aura run [file].js [-b]"
        fi

        FILE=$2
        BACKGROUND=0

        if [ "$3" = "-b" ]; then
            BACKGROUND=1
        fi

        if [ ! -f "$FILE" ]; then
            error "File '$FILE' not found."
        fi

        # Save the start time to the file
        date +%s > "$START_TIME_FILE"

        if [ "$BACKGROUND" -eq 1 ]; then
            command -v pm2 >/dev/null 2>&1 || error "pm2 is required but not installed. Install it with 'npm install -g pm2'"
            echo "Running '$FILE' in background using pm2..."
            pm2 start "$FILE" --name "aura-$FILE"
        else
            echo "Running '$FILE' normally..."
            node "$FILE"
        fi
        ;;
    uptime)
        uptime
        ;;
    *)
        echo "Unknown command: $1"
        exit 1
        ;;
esac
