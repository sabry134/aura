#!/bin/sh

error() {
    echo "Error: $1" >&2
    exit 1
}

if [ "$#" -lt 1 ]; then
    error "Usage: aura run [file].js [-b]"
fi

FILE=$1
BACKGROUND=0

if [ "$2" = "-b" ]; then
    BACKGROUND=1
fi

if [ ! -f "$FILE" ]; then
    error "File '$FILE' not found."
fi

if [ "$BACKGROUND" -eq 1 ]; then
    command -v pm2 >/dev/null 2>&1 || error "pm2 is required but not installed. Install it with 'npm install -g pm2'"
    echo "Running '$FILE' in background using pm2..."
    pm2 start "$FILE" --name "aura-$FILE"
else
    echo "Running '$FILE' normally..."
    node "$FILE"
fi